# Поиск записей по комментариям (REST API)

Этот проект представляет собой веб-приложение, реализующее поиск записей (постов) по содержимому комментариев к ним, используя архитектуру REST API.  Данные для демонстрации импортируются из открытого API `jsonplaceholder.typicode.com`.

## Содержание

1.  [О проекте](#о-проекте)
2.  [Функционал](#функционал)
3.  [Технологии](#технологии)
4.  [Установка и настройка](#установка-и-настройка)
    *   [Предварительные требования](#предварительные-требования)
    *   [Настройка базы данных](#настройка-базы-данных)
    *   [Импорт данных](#импорт-данных)
    *   [Запуск проекта](#Запуск-проекта-на-примере-Xampp)
5.  [Структура проекта](#структура-проекта)
6.  [Использование API](#использование-api)
7.  [Использование Frontend (клиентской части)](#использование-frontend-клиентской-части)

---

## О проекте

Основная идея проекта — продемонстрировать:

*   Разделение на Backend (API) и Frontend (клиент).
*   Взаимодействие с базой данных MySQL с использованием PDO.
*   Выполнение поисковых запросов в базе данных.
*   Импорт данных из внешнего API (`jsonplaceholder.typicode.com`).
*   Создание REST API для поиска данных.
*   Использование JavaScript для динамического взаимодействия с API.
*   Создание простого веб-интерфейса с формой поиска и отображением результатов (клиентская часть).
*   Обработку ошибок и безопасное отображение данных (экранирование HTML и защита API).

## Функционал

*   **Импорт данных:** Скрипт `import_data.php` загружает записи и комментарии с API `jsonplaceholder.typicode.com` и сохраняет их в локальную базу данных MySQL.
*   **REST API:**
    *   **Эндпоинт для поиска:**  `/api/search.php?q=[поисковый_запрос]` (GET запрос).  Принимает параметр `q` с поисковым запросом.
    *   **Ответ в формате JSON:**  API возвращает JSON-объект с результатами поиска.  В случае успеха возвращает массив результатов.  В случае ошибки возвращает объект с информацией об ошибке.
*   **Поиск:** Пользователь вводит текст в поле поиска на клиентской части. Поиск осуществляется по содержимому поля `body` в таблице `comments`.
*   **Минимальная длина запроса:** Поиск выполняется только при вводе не менее 3 символов.  API возвращает ошибку, если запрос короче.
*   **Подсветка результатов:** Найденные фрагменты текста в теле комментариев подсвечиваются на клиентской стороне с помощью JavaScript.
*   **Отображение:** Результаты выводятся с группировкой по постам, отображая заголовок поста и соответствующие комментарии на клиентской части.
*   **Безопасность:**
    *   `htmlspecialchars` используется для предотвращения XSS-атак на клиентской стороне.
    *   API возвращает HTTP-статусы для указания на успех или ошибку запроса.
    *   Экранирование данных, отображаемых в API (на сервере).
*   **Стилизация:** Базовый CSS используется для улучшения внешнего вида клиентской части.

## Технологии

*   **PHP:** Язык программирования (Backend/API).
*   **MySQL:** Система управления базами данных.
*   **PDO (PHP Data Objects):** Уровень абстракции для доступа к базам данных.
*   **cURL:** Библиотека PHP для выполнения HTTP-запросов (используется для импорта данных).
*   **JSON:** Формат обмена данными.
*   **HTML/CSS:** Для структуры и оформления веб-страницы (Frontend/клиентская часть).
*   **JavaScript:** Для динамического взаимодействия с API и обновления содержимого страницы (Frontend/клиентская часть).

## Установка и настройка

### Предварительные требования

*   **PHP:** Версия 7.4 или выше.
*   **MySQL:** Установленный и запущенный сервер MySQL.
*   **PHP Extensions:** `pdo`, `pdo_mysql`, `curl` (обычно включены по умолчанию).
*   **Веб-сервер:** Apache, Nginx или другой, способный обслуживать PHP-файлы.

### Настройка базы данных

1.  **Создайте базу данных:**
    Используйте предоставленный SQL-скрипт для создания базы данных `blog_db` и необходимых таблиц (`posts`, `comments`).

    ```sql
    -- Создание базы данных
    CREATE DATABASE IF NOT EXISTS blog_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    USE blog_db;

    -- Таблица для записей блога
    CREATE TABLE IF NOT EXISTS posts (
        id INT PRIMARY KEY,
        user_id INT NOT NULL,
        title VARCHAR(255) NOT NULL,
        body TEXT NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        INDEX idx_user_id (user_id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

    -- Таблица для комментариев
    CREATE TABLE IF NOT EXISTS comments (
        id INT PRIMARY KEY,
        post_id INT NOT NULL,
        name VARCHAR(255) NOT NULL,
        email VARCHAR(255) NOT NULL,
        body TEXT NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        INDEX idx_post_id (post_id),
        FULLTEXT idx_body (body),
        FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
    ```

2.  **Настройте подключение:**
    Откройте файл `config/database.php` и укажите правильные параметры подключения к вашей базе данных:

    ```php
    <?php
    define('DB_HOST', 'localhost');      // Ваш хост MySQL (например, 'localhost', '127.0.0.1')
    define('DB_NAME', 'blog_db');        // Имя вашей базы данных
    define('DB_USER', 'root');           // Имя пользователя MySQL
    define('DB_PASS', '');               // Пароль пользователя MySQL
    define('DB_CHARSET', 'utf8mb4');     // Кодировка базы данных
    ?>
    ```

### Импорт данных

После настройки базы данных, выполните скрипт импорта данных. Это можно сделать, запустив его из командной строки:

```bash
php import_data.php
```

Этот скрипт загрузит данные с `https://jsonplaceholder.typicode.com/posts` и `https://jsonplaceholder.typicode.com/comments` и заполнит соответствующие таблицы в вашей базе данных.

### Запуск проекта на примере Xampp
1. Запустите модули apache и mySQL.
2. Создайте схему и таблицы с помощью sql запросов в phpMyAdmin (они описанны в пунке [Настройка базы данных](#настройка-базы-данных) )
3. В терминале запустите import.php для загрузки данных с api командой 
```bash 
php import_data.php
```
4. Перейдите в терминале в дирректорию проекта, запустите хост командой 
```bash 
php -S localhost:8000
```

## Структура проекта

```
.
├── api/
│   ├── search.php          # Обрабатывает поисковые запросы (REST API)
│   └── .htaccess           # (Необязательно) для настройки роутинга API
├── config/
│   └── database.php        # Настройки подключения к БД
├── css/
│   └── style.css          # Стили для веб-интерфейса
├── import_data.php        # Скрипт импорта данных из API
├── index.html              # Клиентская часть: форма поиска и отображение результатов
└── script.js               # JavaScript для обработки запросов к API и отрисовки результатов
└── README.md              # Данный файл
```

## Использование API

API предоставляет один эндпоинт для поиска:

*   **Метод:** `GET`
*   **URL:** `/api/search.php?q=[поисковый_запрос]`
*   **Параметр:** `q` (string) - поисковый запрос.
*   **Ответ (JSON):**

    *   **Успешный запрос:**
        ```json
        {
          "success": true,
          "searchTerm": "ваш_запрос",
          "results": [
            {
              "post_id": 1,
              "post_title": "Заголовок поста",
              "comment_body": "Текст комментария",
              "comment_author": "Имя автора",
              "comment_email": "email@example.com"
            },
            ...
          ]
        }
        ```
    *   **Ошибка (например, пустой запрос или ошибка на сервере):**
        ```json
        {
          "success": false,
          "message": "Сообщение об ошибке",
          "results": []
        }
        ```
        HTTP-статусы:
        *   `200 OK` - Успешный запрос.
        *   `400 Bad Request` - Неверный запрос (например, слишком короткий поисковый запрос).
        *   `500 Internal Server Error` - Ошибка на сервере.

## Использование Frontend (клиентской части)

1.  **Откройте `index.html` в браузере.**
2.  **Введите текст:** Введите не менее 3 символов в поле поиска.
3.  **Нажмите "Найти":** Клиентская часть (JavaScript) отправит запрос к API.
4.  **Просмотрите результаты:** Если найдены совпадения, вы увидите список постов, к которым относятся комментарии, с подсветкой искомого текста.  В случае ошибки отобразится сообщение об ошибке.
